

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Step 2: Deployment &mdash; Doctr Versions Menu 0.4.1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="_static/mycss.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/clipboard.min.js"></script>
        <script src="_static/copybutton.js"></script>
        <script src="_static/doctr-versions-menu.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Folder Specifications" href="folderspecs.html" />
    <link rel="prev" title="Step 1: Sphinx extension" href="sphinx_extension.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Doctr Versions Menu
          

          
          </a>

          
            
            
              <div class="version">
                0.4.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="readme.html">Doctr Versions Menu</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="authors.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="history.html">History</a></li>
<li class="toctree-l1"><a class="reference internal" href="sphinx_extension.html">Step 1: Sphinx extension</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Step 2: Deployment</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#doctr-versions-menu"><code class="docutils literal notranslate"><span class="pre">doctr-versions-menu</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#deployment-with-github-actions">Deployment with Github Actions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#command-line-options">Command line options</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#doctr-versions-menu"><code class="docutils literal notranslate"><span class="pre">doctr-versions-menu</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#debugging">Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="#default-assumptions">Default assumptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#customization">Customization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#doctr-versions-menu-environment-variables"><code class="docutils literal notranslate"><span class="pre">DOCTR_VERSIONS_MENU</span></code> environment variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#doctr-versions-menu-conf-configuration-file"><code class="docutils literal notranslate"><span class="pre">doctr-versions-menu.conf</span></code> configuration file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#passing-command-line-options">Passing command line options</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#download-links">Download links</a></li>
<li class="toctree-l2"><a class="reference internal" href="#folders-included-in-the-menu">Folders included in the menu</a></li>
<li class="toctree-l2"><a class="reference internal" href="#labels-in-the-versions-menu">Labels in the versions menu</a></li>
<li class="toctree-l2"><a class="reference internal" href="#custom-warning-messages">Custom warning messages</a></li>
<li class="toctree-l2"><a class="reference internal" href="#customizing-index-html">Customizing <code class="docutils literal notranslate"><span class="pre">index.html</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#maintenance-on-gh-pages">Maintenance on <code class="docutils literal notranslate"><span class="pre">gh-pages</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="folderspecs.html">Folder Specifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="versions_json.html"><code class="docutils literal notranslate"><span class="pre">versions.json</span></code> Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="artifacts.html">Documentation Artifacts</a></li>
<li class="toctree-l1"><a class="reference internal" href="related_software.html">Related software</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Doctr Versions Menu</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Step 2: Deployment</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="step-2-deployment">
<h1>Step 2: Deployment<a class="headerlink" href="#step-2-deployment" title="Permalink to this headline">¶</a></h1>
<div class="section" id="doctr-versions-menu">
<span id="doctr-versions-menu-cli"></span><h2><code class="docutils literal notranslate"><span class="pre">doctr-versions-menu</span></code><a class="headerlink" href="#doctr-versions-menu" title="Permalink to this headline">¶</a></h2>
<p>The Doctr Versions Menu package includes a <code class="docutils literal notranslate"><span class="pre">doctr-versions-menu</span></code>
executable. This executable should be invoked when deploying the documentation
on <a class="reference external" href="https://travis-ci.org">Travis</a>, through <a class="reference external" href="https://drdoctr.github.io/commandline.html#cmdoption-doctr-deploy-command"><code class="docutils literal notranslate"><span class="pre">doctr</span> <span class="pre">deploy</span></code>’s <code class="docutils literal notranslate"><span class="pre">--command</span></code> flag</a>.</p>
<p>As the explicit purpose of the Doctr Versions Menu is to enable documentation
for multiple versions of a package at the same time, you’ll likely want to
invoke <code class="docutils literal notranslate"><span class="pre">doctr</span> <span class="pre">deploy</span></code> also with the <a class="reference external" href="https://drdoctr.github.io/commandline.html#cmdoption-doctr-deploy-no-require-master"><code class="docutils literal notranslate"><span class="pre">--no-required-master</span></code></a> and
<a class="reference external" href="https://drdoctr.github.io/commandline.html#cmdoption-doctr-deploy-build-tags"><code class="docutils literal notranslate"><span class="pre">--build-tags</span></code></a> options.</p>
<p>For example, your <code class="docutils literal notranslate"><span class="pre">.travis.yml</span></code> file might include the following
for deploying previously built documentation:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> ! -z <span class="s2">&quot;</span><span class="nv">$TRAVIS_TAG</span><span class="s2">&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="nv">DEPLOY_DIR</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$TRAVIS_TAG</span><span class="s2">&quot;</span><span class="p">;</span> <span class="k">else</span> <span class="nv">DEPLOY_DIR</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$TRAVIS_BRANCH</span><span class="s2">&quot;</span><span class="p">;</span> <span class="k">fi</span>

doctr deploy --command<span class="o">=</span>doctr-versions-menu --no-require-master --build-tags <span class="s2">&quot;</span><span class="nv">$DEPLOY_DIR</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>See the deploy-section of the Doctr Versions Menu’s <a class="reference external" href="https://github.com/goerz/doctr_versions_menu/blob/master/.travis/doctr_build.sh"><code class="docutils literal notranslate"><span class="pre">doctr_build.sh</span></code> script</a>
(which is sourced from <a class="reference external" href="https://github.com/goerz/doctr_versions_menu/blob/master/.travis.yml"><code class="docutils literal notranslate"><span class="pre">.travis.yml</span></code></a>) for a more detailed example.</p>
<p>The main purpose of the <code class="docutils literal notranslate"><span class="pre">doctr-versions-menu</span></code> command is to generate the
<code class="docutils literal notranslate"><span class="pre">versions.json</span></code> file that the <a class="reference internal" href="sphinx_extension.html#sphinx-extension"><span class="std std-ref">Sphinx extension</span></a>
relies on, in the root of the <code class="docutils literal notranslate"><span class="pre">gh-pages</span></code> branch.</p>
</div>
<div class="section" id="deployment-with-github-actions">
<span id="id1"></span><h2>Deployment with Github Actions<a class="headerlink" href="#deployment-with-github-actions" title="Permalink to this headline">¶</a></h2>
<p>As of December 2020, Travis ended their support for open source software. Thus, it is no longer possible to use Doctr as originally intended and as described throughout this documentation. The recommended alternative for all continous integration (including building documentation) is to use <a class="reference external" href="https://github.com/features/actions">Github Actions</a>. Doctr <a class="reference external" href="https://github.com/drdoctr/doctr/issues/351">may add support for Github Actions in the future</a>. In the meantime, for basic use cases (deploying the documentation to the <code class="docutils literal notranslate"><span class="pre">gh-pages</span></code> branch of the same repository), it is quite straightforward to implement the deployment “by hand”. A possible workflow is the following:</p>
<ul class="simple">
<li><p>Build the documentation, zip the resulting html and upload it as an artifact</p></li>
<li><p>In a second job within the same workflow:</p>
<ul>
<li><p>Check out the <code class="docutils literal notranslate"><span class="pre">gh-pages</span></code> branch</p></li>
<li><p>Download the artifact generated by the first job and unpack it to a temporary location</p></li>
<li><p>Synchronize the unpacked html files with the appropriate subfolder within the <code class="docutils literal notranslate"><span class="pre">gh-pages</span></code> branch</p></li>
<li><p>Run the <code class="docutils literal notranslate"><span class="pre">doctr-versions-menu</span></code> command</p></li>
<li><p>Commit and push the changes.</p></li>
</ul>
</li>
</ul>
<p>What makes this easy within Github Actions, is that the action is automatically authenticated to upload/download artifacts and to have push-access to the underlying repository. Thus, Doctr’s main feature of managing the deploy key for Travis becomes obsolete.</p>
<p><a class="reference external" href="https://github.com/goerz-testing/cython-package-example/blob/e60098f7d38c4a7a8d2ec73fe6e96016f2b47fa5/.github/workflows/docs.yml">An example workflow file illustrates this in more detail.</a></p>
<p>If you are not using Travis/Doctr, you probably also want to <a class="reference internal" href="sphinx_extension.html#sphinx-ext-customization"><span class="std std-ref">change the menu title</span></a>, by putting e.g.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">doctr_versions_menu_conf</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;menu_title&#39;</span><span class="p">:</span> <span class="s1">&#39;Docs&#39;</span>  <span class="c1"># instead of &#39;Doctr&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>in your  <code class="docutils literal notranslate"><span class="pre">conf.py</span></code> file.</p>
</div>
<div class="section" id="command-line-options">
<span id="id2"></span><h2>Command line options<a class="headerlink" href="#command-line-options" title="Permalink to this headline">¶</a></h2>
<div class="section" id="doctr-versions-menu">
<h3><code class="docutils literal notranslate"><span class="pre">doctr-versions-menu</span></code><a class="headerlink" href="#doctr-versions-menu" title="Permalink to this headline">¶</a></h3>
<p class="rubric">Usage</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>doctr-versions-menu <span class="o">[</span>OPTIONS<span class="o">]</span>
</pre></div>
</div>
<p class="rubric">Options</p>
<dl class="std option">
<dt id="cmdoption-doctr-versions-menu-version">
<code class="sig-name descname"><span class="pre">--version</span></code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-doctr-versions-menu-version" title="Permalink to this definition">¶</a></dt>
<dd><p>Show the version and exit.</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-doctr-versions-menu-debug">
<code class="sig-name descname"><span class="pre">--debug</span></code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-doctr-versions-menu-debug" title="Permalink to this definition">¶</a></dt>
<dd><p>enable debug logging
[env var <code class="docutils literal notranslate"><span class="pre">DOCTR_VERSIONS_MENU_DEBUG</span></code>]</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-doctr-versions-menu-o">
<span id="cmdoption-doctr-versions-menu-outfile"></span><code class="sig-name descname"><span class="pre">-o</span></code><code class="sig-prename descclassname"></code><code class="sig-prename descclassname"><span class="pre">,</span> </code><code class="sig-name descname"><span class="pre">--outfile</span></code><code class="sig-prename descclassname"> <span class="pre">&lt;OUTFILE&gt;</span></code><a class="headerlink" href="#cmdoption-doctr-versions-menu-o" title="Permalink to this definition">¶</a></dt>
<dd><p>File to which to write json data
[env var <code class="docutils literal notranslate"><span class="pre">DOCTR_VERSIONS_MENU_OUTFILE</span></code>; default: <code class="docutils literal notranslate"><span class="pre">versions.json</span></code>]</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-doctr-versions-menu-default-branch">
<code class="sig-name descname"><span class="pre">--default-branch</span></code><code class="sig-prename descclassname"> <span class="pre">&lt;DEFAULT_BRANCH&gt;</span></code><a class="headerlink" href="#cmdoption-doctr-versions-menu-default-branch" title="Permalink to this definition">¶</a></dt>
<dd><p>The name or possible names of the default branch for the project. If the project has no public releases, the default <code class="docutils literal notranslate"><span class="pre">index.html</span></code> should forward to the first available default branch. Traditionally, most projects have used ‘master’ as the default branch. More recently, the name ‘main’ has become standard.
[env var <code class="docutils literal notranslate"><span class="pre">DOCTR_VERSIONS_MENU_DEFAULT_BRANCH</span></code>; default: <code class="docutils literal notranslate"><span class="pre">master,</span> <span class="pre">main</span></code>]</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-doctr-versions-menu-versions">
<code class="sig-name descname"><span class="pre">--versions</span></code><code class="sig-prename descclassname"> <span class="pre">&lt;SPEC&gt;</span></code><a class="headerlink" href="#cmdoption-doctr-versions-menu-versions" title="Permalink to this definition">¶</a></dt>
<dd><p>Specification of versions to be included in the menu, from oldest/lowest priority to newest/highest priority. The newest/highest priority items will be shown first. See the online documentation for the <code class="docutils literal notranslate"><span class="pre">SPEC</span></code> syntax.
[env var <code class="docutils literal notranslate"><span class="pre">DOCTR_VERSIONS_MENU_VERSIONS</span></code>; default: <code class="docutils literal notranslate"><span class="pre">(&lt;branches&gt;</span> <span class="pre">!=</span> <span class="pre">&lt;default-branch&gt;),</span> <span class="pre">&lt;releases&gt;,</span> <span class="pre">&lt;default-branch&gt;</span></code>]</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-doctr-versions-menu-latest">
<code class="sig-name descname"><span class="pre">--latest</span></code><code class="sig-prename descclassname"> <span class="pre">&lt;SPEC&gt;</span></code><a class="headerlink" href="#cmdoption-doctr-versions-menu-latest" title="Permalink to this definition">¶</a></dt>
<dd><p>Specification of which version is considered the “latest public release”. If it exists, the main <code class="docutils literal notranslate"><span class="pre">index.html</span></code> should forward to this version, and warnings e.g. for “outdated” versions should link to it. See the online documentation for the <code class="docutils literal notranslate"><span class="pre">SPEC</span></code> syntax.
[env var <code class="docutils literal notranslate"><span class="pre">DOCTR_VERSIONS_MENU_LATEST</span></code>; default: <code class="docutils literal notranslate"><span class="pre">(&lt;public-releases&gt;)[-1]</span></code>]</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-doctr-versions-menu-warning">
<code class="sig-name descname"><span class="pre">--warning</span></code><code class="sig-prename descclassname"> <span class="pre">&lt;NAME</span> <span class="pre">SPEC&gt;</span></code><a class="headerlink" href="#cmdoption-doctr-versions-menu-warning" title="Permalink to this definition">¶</a></dt>
<dd><p>Define a warning. The <code class="docutils literal notranslate"><span class="pre">NAME</span></code> is a lowercase label that will appear in the warnings data in <code class="docutils literal notranslate"><span class="pre">versions.json</span></code> and maybe be picked up by the javascript rendering warning in the HTML output. The <code class="docutils literal notranslate"><span class="pre">SPEC</span></code> is a folder specification for all folders that should show the warning. See the online documentation for the syntax of <code class="docutils literal notranslate"><span class="pre">SPEC</span></code>. The <code class="docutils literal notranslate"><span class="pre">SPEC</span></code> should give given as a quoted string. This option may be given multiple times.If specified via an environment variable, use the form <code class="docutils literal notranslate"><span class="pre">&quot;NAME:</span> <span class="pre">SPEC;</span> <span class="pre">NAME:</span> <span class="pre">SPEC;</span> <span class="pre">…&quot;</span></code>. Any colons and semi-colons in <code class="docutils literal notranslate"><span class="pre">NAME</span></code> and <code class="docutils literal notranslate"><span class="pre">SPEC</span></code> must be escaped in this case. See the online documentation for details.
[env var <code class="docutils literal notranslate"><span class="pre">DOCTR_VERSIONS_MENU_WARNING</span></code>]</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-doctr-versions-menu-label">
<code class="sig-name descname"><span class="pre">--label</span></code><code class="sig-prename descclassname"> <span class="pre">&lt;SPEC</span> <span class="pre">LABELTEMPLATE&gt;</span></code><a class="headerlink" href="#cmdoption-doctr-versions-menu-label" title="Permalink to this definition">¶</a></dt>
<dd><p>Set a template for labels in the versions menu. The <code class="docutils literal notranslate"><span class="pre">LABELTEMPLATE</span></code> applies to all folders matching the given <code class="docutils literal notranslate"><span class="pre">SPEC</span></code>. See the online documentation for the syntax of <code class="docutils literal notranslate"><span class="pre">SPEC</span></code>. The <code class="docutils literal notranslate"><span class="pre">LABELTEMPLATE</span></code> is rendered with Jinja, receiving the <code class="docutils literal notranslate"><span class="pre">folder</span></code> name. See the online documentation for details. This option may be given multiple times. If specified via an environment variables, use the form <code class="docutils literal notranslate"><span class="pre">&quot;SPEC:</span> <span class="pre">LABELTEMPLATE;</span> <span class="pre">SPEC:</span> <span class="pre">LABELTEMPLATE;</span> <span class="pre">…&quot;</span></code>. Any colons and semi-colons in <code class="docutils literal notranslate"><span class="pre">SPEC</span></code> and <code class="docutils literal notranslate"><span class="pre">LABELTEMPLATE</span></code> must be escaped in this case. See the online documentation for details.
[env var <code class="docutils literal notranslate"><span class="pre">DOCTR_VERSIONS_MENU_LABEL</span></code>]</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-doctr-versions-menu-write-index-html">
<span id="cmdoption-doctr-versions-menu-no-write-index-html"></span><code class="sig-name descname"><span class="pre">--write-index-html</span></code><code class="sig-prename descclassname"></code><code class="sig-prename descclassname"><span class="pre">,</span> </code><code class="sig-name descname"><span class="pre">--no-write-index-html</span></code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-doctr-versions-menu-write-index-html" title="Permalink to this definition">¶</a></dt>
<dd><p>Whether to write an <code class="docutils literal notranslate"><span class="pre">index.html</span></code> that forwards to the latest public release. In the config file, override this as <code class="docutils literal notranslate"><span class="pre">write_index_html=False</span></code>.
[env var <code class="docutils literal notranslate"><span class="pre">DOCTR_VERSIONS_MENU_WRITE_INDEX_HTML</span></code>; default: <code class="docutils literal notranslate"><span class="pre">True</span></code>]</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-doctr-versions-menu-write-versions-py">
<span id="cmdoption-doctr-versions-menu-no-write-versions-py"></span><code class="sig-name descname"><span class="pre">--write-versions-py</span></code><code class="sig-prename descclassname"></code><code class="sig-prename descclassname"><span class="pre">,</span> </code><code class="sig-name descname"><span class="pre">--no-write-versions-py</span></code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-doctr-versions-menu-write-versions-py" title="Permalink to this definition">¶</a></dt>
<dd><p>Whether to write a script <code class="docutils literal notranslate"><span class="pre">versions.py</span></code> to the root of the <code class="docutils literal notranslate"><span class="pre">gh-pages</span></code> branch for regenerating <code class="docutils literal notranslate"><span class="pre">versions.json</span></code>. This is useful for maintenance on the <code class="docutils literal notranslate"><span class="pre">gh-pages</span></code> branch, e.g., removing outdated version.
[env var <code class="docutils literal notranslate"><span class="pre">DOCTR_VERSIONS_MENU_WRITE_VERSIONS_PY</span></code>; default: <code class="docutils literal notranslate"><span class="pre">True</span></code>]</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-doctr-versions-menu-ensure-no-jekyll">
<span id="cmdoption-doctr-versions-menu-ignore-no-jekyll"></span><code class="sig-name descname"><span class="pre">--ensure-no-jekyll</span></code><code class="sig-prename descclassname"></code><code class="sig-prename descclassname"><span class="pre">,</span> </code><code class="sig-name descname"><span class="pre">--ignore-no-jekyll</span></code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-doctr-versions-menu-ensure-no-jekyll" title="Permalink to this definition">¶</a></dt>
<dd><p>Whether to check that a .nojekyll file exist and create it otherwise. In the config file, override this as <code class="docutils literal notranslate"><span class="pre">ensure_no_jekyll=False</span></code>.
[env var <code class="docutils literal notranslate"><span class="pre">DOCTR_VERSIONS_MENU_ENSURE_NO_JEKYLL</span></code>; default: <code class="docutils literal notranslate"><span class="pre">True</span></code>]</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-doctr-versions-menu-downloads-file">
<code class="sig-name descname"><span class="pre">--downloads-file</span></code><code class="sig-prename descclassname"> <span class="pre">&lt;FILE&gt;</span></code><a class="headerlink" href="#cmdoption-doctr-versions-menu-downloads-file" title="Permalink to this definition">¶</a></dt>
<dd><p>The name of the file inside of each folder from which to read the download links. Each line in the file must be of the form <code class="docutils literal notranslate"><span class="pre">[label]:</span> <span class="pre">url</span></code>. To disable download links, use <code class="docutils literal notranslate"><span class="pre">--no-downloads-file</span></code> or set the environment variable to an empty string.
[env var <code class="docutils literal notranslate"><span class="pre">DOCTR_VERSIONS_MENU_DOWNLOADS_FILE</span></code>; default: <code class="docutils literal notranslate"><span class="pre">_downloads</span></code>]</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-doctr-versions-menu-no-downloads-file">
<code class="sig-name descname"><span class="pre">--no-downloads-file</span></code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-doctr-versions-menu-no-downloads-file" title="Permalink to this definition">¶</a></dt>
<dd><p>Disable the downloads file. In the config file, use <code class="docutils literal notranslate"><span class="pre">downloads_file</span> <span class="pre">=</span> <span class="pre">False</span></code>. Or, using an environment variable, set <code class="docutils literal notranslate"><span class="pre">DOCTR_VERSIONS_MENU_DOWNLOADS_FILE=&quot;&quot;</span></code>.</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-doctr-versions-menu-suffix-latest">
<code class="sig-name descname"><span class="pre">--suffix-latest</span></code><code class="sig-prename descclassname"> <span class="pre">&lt;suffix_latest&gt;</span></code><a class="headerlink" href="#cmdoption-doctr-versions-menu-suffix-latest" title="Permalink to this definition">¶</a></dt>
<dd><p>Suffix for the label of the latest public release. This is used in addition to any label set via the <a class="reference internal" href="#cmdoption-doctr-versions-menu-label"><code class="xref std std-option docutils literal notranslate"><span class="pre">--label</span></code></a> option
[env var <code class="docutils literal notranslate"><span class="pre">DOCTR_VERSIONS_MENU_SUFFIX_LATEST</span></code>; default: <code class="docutils literal notranslate"><span class="pre"> (latest)</span></code>]</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-doctr-versions-menu-c">
<span id="cmdoption-doctr-versions-menu-config"></span><code class="sig-name descname"><span class="pre">-c</span></code><code class="sig-prename descclassname"></code><code class="sig-prename descclassname"><span class="pre">,</span> </code><code class="sig-name descname"><span class="pre">--config</span></code><code class="sig-prename descclassname"> <span class="pre">&lt;config&gt;</span></code><a class="headerlink" href="#cmdoption-doctr-versions-menu-c" title="Permalink to this definition">¶</a></dt>
<dd><p>Read configuration from <code class="docutils literal notranslate"><span class="pre">FILE</span></code>. Each line in <code class="docutils literal notranslate"><span class="pre">FILE</span></code> should be of the form “variable = value” in Python syntax, with variable names corresponding to any long-form command line flag, e.g. <code class="docutils literal notranslate"><span class="pre">ensure_no_jekyll</span> <span class="pre">=</span> <span class="pre">False</span></code>. Defaults to <code class="docutils literal notranslate"><span class="pre">doctr-versions-menu.conf</span></code>
[env var <code class="docutils literal notranslate"><span class="pre">DOCTR_VERSIONS_MENU_CONFIG</span></code>]</p>
</dd></dl>

</div>
</div>
<div class="section" id="debugging">
<h2>Debugging<a class="headerlink" href="#debugging" title="Permalink to this headline">¶</a></h2>
<p>If the <code class="docutils literal notranslate"><span class="pre">doctr-versions-menu</span></code> command behaves unexpectedly, set the environment variable</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nv">DOCTR_VERSIONS_MENU_DEBUG</span><span class="o">=</span><span class="nb">true</span>
</pre></div>
</div>
<p>in your <code class="docutils literal notranslate"><span class="pre">.travis.yml</span></code> file, see <a class="reference internal" href="#cmdoption-doctr-versions-menu-debug"><code class="xref std std-option docutils literal notranslate"><span class="pre">--debug</span></code></a>.</p>
<p>Make sure to include the debug output when reporting bugs.</p>
</div>
<div class="section" id="default-assumptions">
<h2>Default assumptions<a class="headerlink" href="#default-assumptions" title="Permalink to this headline">¶</a></h2>
<p>You should not have to customize <code class="docutils literal notranslate"><span class="pre">doctr-versions-menu</span></code> (that is, provide
command line options) provided you stick to the following sensible assumptions:</p>
<ul class="simple">
<li><p>Releases should be tagged as e.g. <code class="docutils literal notranslate"><span class="pre">v0.1.0</span></code> and deployed to a folder of the
same name. That is, a lower case letter <code class="docutils literal notranslate"><span class="pre">v</span></code> followed by a <span class="target" id="index-0"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0440"><strong>PEP 440</strong></a>-compatible
version identifier.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">master</span></code> branch should be deployed to a folder <code class="docutils literal notranslate"><span class="pre">master</span></code>, respectively
<code class="docutils literal notranslate"><span class="pre">main</span></code> to a folder <code class="docutils literal notranslate"><span class="pre">main</span></code> for projects that <a class="reference external" href="https://github.blog/changelog/2020-10-01-the-default-branch-for-newly-created-repositories-is-now-main/">use “main” as the default branch name</a>.</p></li>
<li><p>Any other branch for which documentation is to be deployed should go in a
folder matching the branch name.</p></li>
</ul>
<p>By default, the <code class="docutils literal notranslate"><span class="pre">index.html</span></code> file will forward to the documentation of the
latest public release (excluding pre-releases such as <code class="docutils literal notranslate"><span class="pre">v1.0.0-rc1</span></code>), or to
the default branch (<code class="docutils literal notranslate"><span class="pre">main</span></code> or <code class="docutils literal notranslate"><span class="pre">master</span></code>) if there have been no public releases.
There is no support for an RTD-style “latest”/”stable” folder. This is by
design: deep-linking to “latest” documentation is a bad practice, as such links
easily become invalid when a new version is released.</p>
</div>
<div class="section" id="customization">
<h2>Customization<a class="headerlink" href="#customization" title="Permalink to this headline">¶</a></h2>
<p>If you do need to customize <code class="docutils literal notranslate"><span class="pre">doctr-versions-menu</span></code>’s behavior, there are three options:</p>
<ol class="arabic simple">
<li><p>Set the various <code class="docutils literal notranslate"><span class="pre">DOCTR_VERSIONS_MENU_*</span></code> environment variables</p></li>
<li><p>Place a configuration file <code class="docutils literal notranslate"><span class="pre">doctr-versions-menu.conf</span></code> in the root of the <code class="docutils literal notranslate"><span class="pre">gh-pages</span></code> branch</p></li>
<li><p>Call the <code class="docutils literal notranslate"><span class="pre">doctr-versions-menu</span></code> executable with explicit command line options</p></li>
</ol>
<div class="section" id="doctr-versions-menu-environment-variables">
<span id="doctr-versions-menu-envvars"></span><h3><code class="docutils literal notranslate"><span class="pre">DOCTR_VERSIONS_MENU</span></code> environment variables<a class="headerlink" href="#doctr-versions-menu-environment-variables" title="Permalink to this headline">¶</a></h3>
<p>The recommended way to customize <code class="docutils literal notranslate"><span class="pre">doctr-versions-menu</span></code> it to set environment
variables. Each of <code class="docutils literal notranslate"><span class="pre">doctr-versions-menu</span></code>’s command-line-options has an
associated environment variable, as listed in the documentation of the
<a class="reference internal" href="#command-line-options"><span class="std std-ref">Command line options</span></a>.  You can set these environment variables in your
<a class="reference external" href="https://github.com/goerz/doctr_versions_menu/blob/master/.travis.yml"><code class="docutils literal notranslate"><span class="pre">.travis.yml</span></code></a> file.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>It can be quite tricky to properly specify environment variables in the
YAML format used for the <code class="docutils literal notranslate"><span class="pre">travis.yml</span></code> configuration file. This is due to
<a class="reference external" href="https://www.yaml.info/learn/quote.html">YAML’s complicated string-quoting rules</a>.  For
<code class="docutils literal notranslate"><span class="pre">DOCTR_VERSIONS_MENU_VERSIONS</span></code> (see <a class="reference internal" href="#cmdoption-doctr-versions-menu-versions"><code class="xref std std-option docutils literal notranslate"><span class="pre">--versions</span></code></a>),
<code class="docutils literal notranslate"><span class="pre">DOCTR_VERSIONS_MENU_LABEL</span></code> (see <a class="reference internal" href="#cmdoption-doctr-versions-menu-label"><code class="xref std std-option docutils literal notranslate"><span class="pre">--label</span></code></a>), and
<code class="docutils literal notranslate"><span class="pre">DOCTR_VERSIONS_MENU_WARNING</span></code> (see <a class="reference internal" href="#cmdoption-doctr-versions-menu-warning"><code class="xref std std-option docutils literal notranslate"><span class="pre">--warning</span></code></a>) in particular,
you will likely have to <strong>triple-quote the values</strong> to avoid Travis
inperpolating inside of them.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">DOCTR_VERSIONS_MENU_VERSIONS</span><span class="p">:</span> <span class="s">&#39;</span><span class="se">&#39;&#39;</span><span class="s">(&lt;branches&gt;</span><span class="nv"> </span><span class="s">!=</span><span class="nv"> </span><span class="s">(master,</span><span class="nv"> </span><span class="s">rtd-theme)),</span><span class="nv"> </span><span class="s">(&lt;releases&gt;)[:-1],</span><span class="nv"> </span><span class="s">rtd-theme,</span><span class="nv"> </span><span class="s">(&lt;releases&gt;)[-1],</span><span class="nv"> </span><span class="s">master</span><span class="se">&#39;&#39;</span><span class="s">&#39;</span>
<span class="p p-Indicator">-</span> <span class="nt">DOCTR_VERSIONS_MENU_LABEL</span><span class="p">:</span> <span class="s">&#39;</span><span class="se">&#39;&#39;</span><span class="s">rtd-theme:</span><span class="nv"> </span><span class="s">v0.2.0</span><span class="nv"> </span><span class="s">(rtd-theme)</span><span class="se">&#39;&#39;</span><span class="s">&#39;</span>
<span class="p p-Indicator">-</span> <span class="nt">DOCTR_VERSIONS_MENU_WARNING</span><span class="p">:</span> <span class="s">&#39;</span><span class="se">&#39;&#39;</span><span class="s">unreleased:</span><span class="nv"> </span><span class="s">(&lt;branches&gt;</span><span class="nv"> </span><span class="s">!=</span><span class="nv"> </span><span class="s">rtd-theme),</span><span class="nv"> </span><span class="s">&lt;local-releases&gt;</span><span class="se">&#39;&#39;</span><span class="s">&#39;</span>
</pre></div>
</div>
</div>
<p>For the <a class="reference internal" href="#cmdoption-doctr-versions-menu-warning"><code class="xref std std-option docutils literal notranslate"><span class="pre">--warning</span></code></a> and <a class="reference internal" href="#cmdoption-doctr-versions-menu-label"><code class="xref std std-option docutils literal notranslate"><span class="pre">--label</span></code></a> options which can occur
multiple times on the command line and take two arguments, the equivalent
specification with an environment variable must separate the two arguments
with a colon, and multiple argument pairs with a semicolon. Consequently,
colons and semicolons that occur inside the arguments must be escaped with a
backslash.</p>
</div>
<div class="section" id="doctr-versions-menu-conf-configuration-file">
<span id="doctr-versions-menu-conf"></span><h3><code class="docutils literal notranslate"><span class="pre">doctr-versions-menu.conf</span></code> configuration file<a class="headerlink" href="#doctr-versions-menu-conf-configuration-file" title="Permalink to this headline">¶</a></h3>
<p>An alternative way to configure <code class="docutils literal notranslate"><span class="pre">doctr-versions-menu</span></code> is to place a
configuration file <code class="docutils literal notranslate"><span class="pre">doctr-versions-menu.conf</span></code> in the root of the <code class="docutils literal notranslate"><span class="pre">gh-pages</span></code>
branch. Compared to setting environment variables in the <code class="docutils literal notranslate"><span class="pre">.travis.yml</span></code> file,
this has the drawback that the configuration of your documentation is not
tracked as part of your <code class="docutils literal notranslate"><span class="pre">main</span></code>/<code class="docutils literal notranslate"><span class="pre">master</span></code> branch, but instead lives on the
<code class="docutils literal notranslate"><span class="pre">gh-pages</span></code> branch. Thus, changes to the documentation may involve organizing
work spread across multiple branches, which can get confusing.</p>
<p>The configuration file can contain definitions matching
<code class="docutils literal notranslate"><span class="pre">doctr-versions-menu</span></code>’s <a class="reference internal" href="#command-line-options"><span class="std std-ref">Command line options</span></a>, formatted according to
<a class="reference external" href="https://configobj.readthedocs.io/en/latest/configobj.html#unrepr-mode">Configobj’s unrepr mode</a>.</p>
<p>Every long-form flag has a corresponding config file variable, obtained by
replacing hyphens with underscores. For boolean flags, the variable name is
derived from the <em>first</em> flag option.</p>
<p>For example, the settings</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">downloads_file</span> <span class="o">=</span> <span class="s2">&quot;.downloads&quot;</span>
<span class="n">ensure_no_jekyll</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
<p>correspond to <code class="docutils literal notranslate"><span class="pre">--downloads-file=.downloads</span></code> and <code class="docutils literal notranslate"><span class="pre">--ignore-no-jekyll</span></code>.</p>
<p>See also <a class="reference external" href="https://raw.githubusercontent.com/goerz/doctr_versions_menu/158b2ed0870e562b5a9eeb3a556a1f5600b9b8f7/doctr-versions-menu.conf">this doctr-versions-menu.conf file</a>, which illustrates some advanced
usage.</p>
</div>
<div class="section" id="passing-command-line-options">
<h3>Passing command line options<a class="headerlink" href="#passing-command-line-options" title="Permalink to this headline">¶</a></h3>
<p>Lastly, you may also explicitly invoke the <code class="docutils literal notranslate"><span class="pre">doctr-versions-menu</span></code> executable with specific
<a class="reference internal" href="#command-line-options"><span class="std std-ref">Command line options</span></a> in your <a class="reference external" href="https://github.com/goerz/doctr_versions_menu/blob/master/.travis.yml"><code class="docutils literal notranslate"><span class="pre">.travis.yml</span></code></a>, respectively the <a class="reference external" href="https://github.com/goerz/doctr_versions_menu/blob/master/.travis/doctr_build.sh"><code class="docutils literal notranslate"><span class="pre">doctr_build.sh</span></code> script</a>.</p>
<p>For example, you might have the following deploy command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">doctr</span> <span class="n">deploy</span> <span class="o">--</span><span class="n">key</span><span class="o">-</span><span class="n">path</span> <span class="n">docs</span><span class="o">/</span><span class="n">doctr_deploy_key</span><span class="o">.</span><span class="n">enc</span> \
        <span class="o">--</span><span class="n">command</span><span class="o">=</span><span class="s1">&#39;doctr-versions-menu --debug&#39;</span> \
        <span class="o">--</span><span class="n">built</span><span class="o">-</span><span class="n">docs</span> <span class="n">docs</span><span class="o">/</span><span class="n">_build</span><span class="o">/</span><span class="n">html</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">require</span><span class="o">-</span><span class="n">master</span> \
        <span class="o">--</span><span class="n">build</span><span class="o">-</span><span class="n">tags</span> <span class="s2">&quot;$DEPLOY_DIR&quot;</span>
</pre></div>
</div>
<p>Note the quotes around <code class="docutils literal notranslate"><span class="pre">--command</span></code>’s argument.
Generally, the use of environment variables is more readable and easier to
maintain, so you should avoid using command line options as part of your
automated builds.</p>
</div>
</div>
<div class="section" id="download-links">
<span id="id3"></span><h2>Download links<a class="headerlink" href="#download-links" title="Permalink to this headline">¶</a></h2>
<p>By default, <code class="docutils literal notranslate"><span class="pre">doctr-versions-menu</span></code> looks for a file <code class="docutils literal notranslate"><span class="pre">_downloads</span></code> inside each
folder on the <code class="docutils literal notranslate"><span class="pre">gh-pages</span></code> branch. Each line in this file should have the
markdown-like format <code class="docutils literal notranslate"><span class="pre">[label]:</span> <span class="pre">url</span></code>, e.g.</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span>[<span class="nl">html</span>]: <span class="na">https://dl.bintray.com/goerz/doctr_versions_menu/doctr_versions_menu-v0.1.0.zip</span>
</pre></div>
</div>
<p>These links will be shown in the versions menu in a section “Downloads”, using
the label as the link text. See <a class="reference internal" href="artifacts.html#doc-artifacts"><span class="std std-ref">Documentation Artifacts</span></a> for further
information on how to build and upload the underlying files. The name of the
file can be changed via the <code class="docutils literal notranslate"><span class="pre">DOCTR_VERSIONS_MENU_DOWNLOADS_FILE</span></code> environment
variable (see <a class="reference internal" href="#cmdoption-doctr-versions-menu-downloads-file"><code class="xref std std-option docutils literal notranslate"><span class="pre">--downloads-file</span></code></a>).</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">_downloads</span></code> file is missing, you will see a warning message during
the deploy. To disable use of a <code class="docutils literal notranslate"><span class="pre">_downloads</span></code> file (ignore existing files, and
don’t warn for missing files), set <code class="docutils literal notranslate"><span class="pre">DOCTR_VERSIONS_MENU_DOWNLOADS_FILE</span></code> to an
empty string (see <a class="reference internal" href="#cmdoption-doctr-versions-menu-no-downloads-file"><code class="xref std std-option docutils literal notranslate"><span class="pre">--no-downloads-file</span></code></a>).</p>
</div>
<div class="section" id="folders-included-in-the-menu">
<h2>Folders included in the menu<a class="headerlink" href="#folders-included-in-the-menu" title="Permalink to this headline">¶</a></h2>
<p>By default, the version menu lists the default branch (<code class="docutils literal notranslate"><span class="pre">main</span></code> or <code class="docutils literal notranslate"><span class="pre">master</span></code>,
see <a class="reference internal" href="#cmdoption-doctr-versions-menu-default-branch"><code class="xref std std-option docutils literal notranslate"><span class="pre">--default-branch</span></code></a>) first, then any releases from newest to oldest,
and then any non-release branches in reverse-alphabetical order. Having the
“newest” releases appear first matches the behavior of Read-the-Docs.</p>
<p>The folders that are listed in the versions menu and their order can be
customized via the <a class="reference internal" href="#cmdoption-doctr-versions-menu-versions"><code class="xref std std-option docutils literal notranslate"><span class="pre">--versions</span></code></a> flag (<code class="docutils literal notranslate"><span class="pre">DOCTR_VERSIONS_MENU_VERSIONS</span></code>
environment variable, or <code class="docutils literal notranslate"><span class="pre">versions</span></code> in the config file).
This receives a <a class="reference internal" href="folderspecs.html#folderspecs"><span class="std std-ref">folder specification</span></a> as an argument that
specifies the folders to appear in the menu in reverse order (bottom/right to
top/left).</p>
<p>To un-reverse the default order of folders in the menu, so that the newest
versions and the default branch appear last, you would put</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">DOCTR_VERSIONS_MENU_VERSIONS</span><span class="p">:</span> <span class="s">&#39;</span><span class="se">&#39;&#39;</span><span class="s">((&lt;branches&gt;</span><span class="nv"> </span><span class="s">not</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">&lt;default-branch&gt;),</span><span class="nv"> </span><span class="s">&lt;releases&gt;,</span><span class="nv"> </span><span class="s">&lt;default-branch&gt;)[::-1]</span><span class="se">&#39;&#39;</span><span class="s">&#39;</span>
</pre></div>
</div>
<p>in the definitions of environment variables in your <a class="reference external" href="https://github.com/goerz/doctr_versions_menu/blob/master/.travis.yml"><code class="docutils literal notranslate"><span class="pre">.travis.yml</span></code></a> file.</p>
</div>
<div class="section" id="labels-in-the-versions-menu">
<span id="id4"></span><h2>Labels in the versions menu<a class="headerlink" href="#labels-in-the-versions-menu" title="Permalink to this headline">¶</a></h2>
<p>By default, the label for each folder that appears in the menu is simply the
name of the folder. The “latest public release”, identified by
<a class="reference internal" href="#cmdoption-doctr-versions-menu-latest"><code class="xref std std-option docutils literal notranslate"><span class="pre">--latest</span></code></a> (the latest public release by default), has
“(latest)” appended. This can be customized with
<a class="reference internal" href="#cmdoption-doctr-versions-menu-suffix-latest"><code class="xref std std-option docutils literal notranslate"><span class="pre">--suffix-latest</span></code></a> (<code class="docutils literal notranslate"><span class="pre">DOCTR_VERSIONS_MENU_SUFFIX_LATEST</span></code> environment
variable).</p>
<p>More generally, the <a class="reference internal" href="#cmdoption-doctr-versions-menu-label"><code class="xref std std-option docutils literal notranslate"><span class="pre">--label</span></code></a> option may be used to define label
templates for specific groups of folders. The option can be given multiple
times. Each <a class="reference internal" href="#cmdoption-doctr-versions-menu-label"><code class="xref std std-option docutils literal notranslate"><span class="pre">--label</span></code></a> receives two arguments, a <a class="reference internal" href="folderspecs.html#folderspecs"><span class="std std-ref">folder
specification</span></a> for the folders to which the template should
apply, and a Jinja-template-string that should receive the variable <code class="docutils literal notranslate"><span class="pre">folder</span></code>
for rendering. For example,</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>doctr-versions-menu --label <span class="s1">&#39;&lt;releases&gt;&#39;</span>  <span class="s2">&quot;{{ folder | replace(&#39;v&#39;, &#39;&#39;, 1) }}&quot;</span> --label master <span class="s1">&#39;{{ folder }} (latest dev branch)&#39;</span>
</pre></div>
</div>
<p>drops the initial <code class="docutils literal notranslate"><span class="pre">v</span></code> from the folder name of released versions (<code class="docutils literal notranslate"><span class="pre">v1.0.0</span></code> →
<code class="docutils literal notranslate"><span class="pre">1.0.0</span></code>) and appends a label `` (latest dev branch)`` to the label for the
<code class="docutils literal notranslate"><span class="pre">master</span></code> folder.</p>
<p>When specifying the labels via the <code class="docutils literal notranslate"><span class="pre">DOCTR_VERSIONS_MENU_LABEL</span></code> environment
variable, the multiple <code class="docutils literal notranslate"><span class="pre">--label</span></code> options are combined into a single value,
separated by semicolons, and the two arguments separated by a colon. For the
above example, an appropriate definition in <a class="reference external" href="https://github.com/goerz/doctr_versions_menu/blob/master/.travis.yml"><code class="docutils literal notranslate"><span class="pre">.travis.yml</span></code></a>’s environment
variable definitions would be</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">DOCTR_VERSIONS_MENU_LABEL</span><span class="p">:</span> <span class="s">&#39;</span><span class="se">&#39;&#39;</span><span class="s">&lt;releases&gt;:</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">folder</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">replace(&quot;v&quot;,</span><span class="nv"> </span><span class="s">&quot;&quot;,</span><span class="nv"> </span><span class="s">1)</span><span class="nv"> </span><span class="s">}};</span><span class="nv"> </span><span class="s">master:</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">folder</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">(latest</span><span class="nv"> </span><span class="s">dev</span><span class="nv"> </span><span class="s">branch)</span><span class="se">&#39;&#39;</span><span class="s">&#39;</span>
</pre></div>
</div>
<p>Note the triple-quotes, which are required here (technically, the single outer
quotes prevent YAML from performing any escapes inside the string except for
<a class="reference external" href="https://www.yaml.info/learn/quote.html#single">transforming the two inner quotes into a single quote</a> which then prevents
the shell from interpolating inside the string).</p>
<p>Similarly, in a config file, the above options would be specified as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;[</span>
<span class="s1">    (&#39;&lt;releases&gt;&#39;, &quot;{{ folder | replace(&#39;v&#39;, &#39;&#39;, 1) }}&quot;),</span>
<span class="s1">    (&#39;master&#39;, &#39;{{ folder }} (latest dev branch)&#39;)</span>
<span class="s1">]&#39;&#39;&#39;</span>
</pre></div>
</div>
<p>The triple-quotes are required for a multi-line entry.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Read-the-Docs uses “latest” to refer to the latest development
version (usually <code class="docutils literal notranslate"><span class="pre">main</span></code>/<code class="docutils literal notranslate"><span class="pre">master</span></code>) instead of the latest public release,
and instead labels the latest public release as “stable”. You may adopt
Read-the-Docs nomeclature with e.g.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>--suffix-latest<span class="o">=</span><span class="s2">&quot; (stable)&quot;</span> --label master <span class="s1">&#39;master (latest)&#39;</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>--suffix-latest<span class="o">=</span><span class="s2">&quot; (stable)&quot;</span> --label master latest
</pre></div>
</div>
</div>
</div>
<div class="section" id="custom-warning-messages">
<h2>Custom warning messages<a class="headerlink" href="#custom-warning-messages" title="Permalink to this headline">¶</a></h2>
<p>By default, the Doctr Versions Menu plugin injects warnings in the rendered
HTML files, within the following types of folders:</p>
<ul class="simple">
<li><p>an ‘outdated’ warning for <code class="docutils literal notranslate"><span class="pre">&lt;releases&gt;</span></code> older than the latest public release (identified by <a class="reference internal" href="#cmdoption-doctr-versions-menu-latest"><code class="xref std std-option docutils literal notranslate"><span class="pre">--latest</span></code></a>)</p></li>
<li><p>an ‘unreleased’ warning for <code class="docutils literal notranslate"><span class="pre">&lt;branches&gt;</span></code> (anything that is not a <span class="target" id="index-1"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0440"><strong>PEP 440</strong></a>-conforming release), or <code class="docutils literal notranslate"><span class="pre">&lt;local-releases&gt;</span></code> (typically not used)</p></li>
<li><p>a ‘prereleased’ warning for anything considered a pre-release by <span class="target" id="index-2"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0440"><strong>PEP 440</strong></a>, e.g. <code class="docutils literal notranslate"><span class="pre">v1.0.0-rc1</span></code></p></li>
</ul>
<p>Which folders are included in the above three categories can be modified via the <a class="reference internal" href="#cmdoption-doctr-versions-menu-warning"><code class="xref std std-option docutils literal notranslate"><span class="pre">--warning</span></code></a> option.
This options receives two arguments, a “warning label” string (the above
‘outdated’, ‘unreleased’, or ‘prereleased’), and a
<a class="reference internal" href="folderspecs.html#folderspecs"><span class="std std-ref">folder specification</span></a> for the
folders to which the warning should apply. The option can be given multiple
times. An empty specification would disable the warning, e.g.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>doctr-versions-menu --warning prereleased <span class="s1">&#39;&#39;</span>
</pre></div>
</div>
<p>to disable the warning message on pre-releases.</p>
<p>It is also possible to define entirely new warning labels using <a class="reference internal" href="#cmdoption-doctr-versions-menu-warning"><code class="xref std std-option docutils literal notranslate"><span class="pre">--warning</span></code></a>. For example,</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>doctr-versions-menu --warning post <span class="s1">&#39;&lt;post-releases&gt;&#39;</span>
</pre></div>
</div>
<p>would define a warning ‘post’ for all post-releases.</p>
<p>The information about which folders should display which warnings is stored
internally in the resulting <code class="docutils literal notranslate"><span class="pre">versions.json</span></code> file, in a dict ‘warnings’ the
maps folder names to a list of warning labels.</p>
<p>To actually show this new custom warning, the <code class="docutils literal notranslate"><span class="pre">doctr-versions-menu.js_t</span></code>
template would have to be modified to pick up on the ‘post’ label, see the
instructions for the <a class="reference internal" href="sphinx_extension.html#sphinx-ext-customization"><span class="std std-ref">Customization</span></a> of the
<code class="docutils literal notranslate"><span class="pre">doctr_versions_menu</span></code> Sphinx extension.</p>
<p>Similarly to <a class="reference internal" href="#labels-in-the-versions-menu"><span class="std std-ref">Labels in the versions menu</span></a>, when configuring the warnings
via the <code class="docutils literal notranslate"><span class="pre">DOCTR_VERSIONS_MENU_WARNING</span></code> environment variable, multiple
<a class="reference internal" href="#cmdoption-doctr-versions-menu-warning"><code class="xref std std-option docutils literal notranslate"><span class="pre">--warning</span></code></a> options are combined into a single value, separated by
semicolons, and the warning label and folder specification separated by a
colon.</p>
<p>For the above two options, you might include the following the definition of
the environment variables in the <a class="reference external" href="https://github.com/goerz/doctr_versions_menu/blob/master/.travis.yml"><code class="docutils literal notranslate"><span class="pre">.travis.yml</span></code></a> file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">DOCTR_VERSIONS_MENU_WARNING</span><span class="p">:</span> <span class="s">&#39;</span><span class="se">&#39;&#39;</span><span class="s">post:</span><span class="nv"> </span><span class="s">&lt;post-relases&gt;;</span><span class="nv"> </span><span class="s">prereleased:</span><span class="se">&#39;&#39;</span><span class="s">&#39;</span>
</pre></div>
</div>
<p>The triple-quotes are required to protect the string from both YAML and shell
interpolation.</p>
<p>In the config file, the above options may be configured as e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">warning</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;[</span>
<span class="s1">    (&#39;post&#39;, &#39;&lt;post-releases&gt;&#39;),</span>
<span class="s1">    (&#39;prereleased&#39;, &#39;&#39;),</span>
<span class="s1">]&#39;&#39;&#39;</span>
</pre></div>
</div>
<p>The default settings (with the default <a class="reference internal" href="#cmdoption-doctr-versions-menu-latest"><code class="xref std std-option docutils literal notranslate"><span class="pre">--latest</span></code></a>) correspond to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">warning</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;[</span>
<span class="s1">    (&#39;outdated&#39;, &#39;(&lt;releases&gt; &lt; (&lt;public-releases&gt;)[-1])&#39;),</span>
<span class="s1">    (&#39;unreleased&#39;,  &#39;&lt;branches&gt;, &lt;local-releases&gt;&#39;),</span>
<span class="s1">    (&#39;prereleased&#39;, &#39;&lt;pre-releases&gt;&#39;),</span>
<span class="s1">]&#39;&#39;&#39;</span>
</pre></div>
</div>
<p>Note the triple-quotes required for a multi-line entry.</p>
</div>
<div class="section" id="customizing-index-html">
<span id="id5"></span><h2>Customizing <code class="docutils literal notranslate"><span class="pre">index.html</span></code><a class="headerlink" href="#customizing-index-html" title="Permalink to this headline">¶</a></h2>
<p>By default, <code class="docutils literal notranslate"><span class="pre">doctr-versions-menu</span></code> generates an <code class="docutils literal notranslate"><span class="pre">index.html</span></code> file in the
root of the <code class="docutils literal notranslate"><span class="pre">gh-pages</span></code> branch that redirects to the current “default folder”.
This is the folder for the most current public release (<a class="reference internal" href="#cmdoption-doctr-versions-menu-latest"><code class="xref std std-option docutils literal notranslate"><span class="pre">--latest</span></code></a>), or
the default branch (see <a class="reference internal" href="#cmdoption-doctr-versions-menu-default-branch"><code class="xref std std-option docutils literal notranslate"><span class="pre">--default-branch</span></code></a>) if no public release exists.</p>
<p>The generated <code class="docutils literal notranslate"><span class="pre">index.html</span></code> file can be customized by placing an
<code class="docutils literal notranslate"><span class="pre">index.html_t</span></code> <a class="reference external" href="https://jinja.palletsprojects.com/en/2.10.x/">Jinja</a> template into the root of the <code class="docutils literal notranslate"><span class="pre">gh-pages</span></code> branch.
This template will be rendered receiving a dict <code class="docutils literal notranslate"><span class="pre">version_data</span></code> containing the
data in <code class="docutils literal notranslate"><span class="pre">versions.json</span></code> (see the <a class="reference internal" href="versions_json.html#versions-json-structure"><span class="std std-ref">versions.json Structure</span></a>).</p>
<p>The default template is</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;Refresh&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;0; url={{ version_data[&#39;latest&#39;] | default(version_data[&#39;default-branch&#39;]) | default(version_data[&#39;folders&#39;][0], true) }}&quot;</span> <span class="p">/&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Go to the <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ version_data[&#39;latest&#39;] | default(version_data[&#39;default-branch&#39;])  | default(version_data[&#39;folders&#39;][0], true) }}&quot;</span><span class="p">&gt;</span>default documentation<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Alternatively, if you want a completely static <code class="docutils literal notranslate"><span class="pre">index.html</span></code>, you could also
just add that file by hand and use <a class="reference internal" href="#cmdoption-doctr-versions-menu-write-index-html"><code class="xref std std-option docutils literal notranslate"><span class="pre">--no-write-index-html</span></code></a>
(that is, <code class="docutils literal notranslate"><span class="pre">DOCTR_VERSIONS_MENU_WRITE_INDEX_HTML=false</span></code> as an environment
variable or <code class="docutils literal notranslate"><span class="pre">write_index_html=False</span></code> in the <a class="reference internal" href="#doctr-versions-menu-conf"><span class="std std-ref">doctr-versions-menu.conf configuration file</span></a>).</p>
</div>
<div class="section" id="maintenance-on-gh-pages">
<h2>Maintenance on <code class="docutils literal notranslate"><span class="pre">gh-pages</span></code><a class="headerlink" href="#maintenance-on-gh-pages" title="Permalink to this headline">¶</a></h2>
<p>Unless <a class="reference internal" href="#cmdoption-doctr-versions-menu-write-versions-py"><code class="xref std std-option docutils literal notranslate"><span class="pre">--no-write-versions-py</span></code></a> is given or
<code class="docutils literal notranslate"><span class="pre">DOCTR_VERSIONS_MENU_WRITE_VERSIONS_PY=false</span></code> is set, running
<code class="docutils literal notranslate"><span class="pre">doctr-versions-menu</span></code> will generate a script <code class="docutils literal notranslate"><span class="pre">versions.py</span></code> in the root of
the <code class="docutils literal notranslate"><span class="pre">gh-pages</span></code> branch that may be used to regenerate the <code class="docutils literal notranslate"><span class="pre">versions.json</span></code>
file. This script is intended for manual maintenance on the <code class="docutils literal notranslate"><span class="pre">gh-pages</span></code>
branch, that is, outside of the normal automatic Doctr-deployment through
Travis. For example, you may occasionally want to remove folders for outdated
branches or pre-releases from the <code class="docutils literal notranslate"><span class="pre">gh-pages</span></code> branch, or update existing
download links.</p>
<p>After any such change, run the <code class="docutils literal notranslate"><span class="pre">versions.py</span></code> script before committing and
pushing the <code class="docutils literal notranslate"><span class="pre">gh-pages</span></code> branch.</p>
<p>Remember that each folder on the <code class="docutils literal notranslate"><span class="pre">gh-pages</span></code> branch generally contains its own
<code class="docutils literal notranslate"><span class="pre">doctr-versions-menu.js</span></code> script. Switching a project to a new major version
of <code class="docutils literal notranslate"><span class="pre">doctr-versions-menu</span></code>, if that version changes the internal data structure of
<code class="docutils literal notranslate"><span class="pre">versions.json</span></code>, may require updating the <code class="docutils literal notranslate"><span class="pre">doctr-versions-menu.js</span></code> script
in existing folders by hand.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="folderspecs.html" class="btn btn-neutral float-right" title="Folder Specifications" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="sphinx_extension.html" class="btn btn-neutral float-left" title="Step 1: Sphinx extension" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Michael Goerz.
      <span class="lastupdated">
        Last updated on Mar 18, 2021.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>